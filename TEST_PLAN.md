# Doctrine Timestamp Bundle æµ‹è¯•è®¡åˆ’

## æµ‹è¯•æ¦‚è§ˆ

- **æ¨¡å—åç§°**: Doctrine Timestamp Bundle
- **æµ‹è¯•ç±»å‹**: é›†æˆæµ‹è¯• + å•å…ƒæµ‹è¯•
- **æµ‹è¯•æ¡†æ¶**: PHPUnit 10.0+
- **ç›®æ ‡**: å®Œæ•´åŠŸèƒ½æµ‹è¯•è¦†ç›–
- **è‡ªå®šä¹‰æµ‹è¯•å†…æ ¸**: ä½¿ç”¨ CustomIntegrationTestKernel æ”¯æŒè‡ªå®šä¹‰å®ä½“æ˜ å°„

## é›†æˆæµ‹è¯•ç”¨ä¾‹è¡¨

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/Integration/TimeListenerServiceTest.php | TimeListenerServiceTest | æœåŠ¡æ³¨å†Œå’Œä¾èµ–æ³¨å…¥éªŒè¯ | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |
| tests/Integration/DoctrineTimestampIntegrationTest.php | DoctrineTimestampIntegrationTest | å®é™…æ•°æ®åº“æ“ä½œçš„æ—¶é—´æˆ³è‡ªåŠ¨è®¾ç½® | âš ï¸ æœ‰é—®é¢˜ | âŒ éƒ¨åˆ†å¤±è´¥ |
| tests/Integration/TimeListenerIntegrationTest.php | TimeListenerIntegrationTest | TimeListeneräº‹ä»¶ç›‘å¬å™¨çœŸå®åŠŸèƒ½æµ‹è¯• | âš ï¸ æœ‰é—®é¢˜ | âŒ éƒ¨åˆ†å¤±è´¥ |

## å•å…ƒæµ‹è¯•ç”¨ä¾‹è¡¨

### TimeListener æ ¸å¿ƒå•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/EventSubscriber/TimeListenerUnitTest.php | TimeListenerUnitTest | TimeListeneræ ¸å¿ƒé€»è¾‘æµ‹è¯• | âœ… å·²å®Œæˆ | âœ… 5/5é€šè¿‡ |

### Attribute å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/Attribute/CreateTimeColumnTest.php | CreateTimeColumnTest | åˆ›å»ºæ—¶é—´å±æ€§é…ç½®å’Œç±»å‹éªŒè¯ | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |
| tests/Attribute/UpdateTimeColumnTest.php | UpdateTimeColumnTest | æ›´æ–°æ—¶é—´å±æ€§é…ç½®å’Œç±»å‹éªŒè¯ | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |
| tests/Attribute/AttributeTest.php | AttributeTest | å±æ€§ç»¼åˆåŠŸèƒ½æµ‹è¯• | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |

### EventSubscriber å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/EventSubscriber/TimeListenerTest.php | TimeListenerTest | TimeListeneräº‹ä»¶å¤„ç†é€»è¾‘ | âš ï¸ æœ‰é—®é¢˜ | âŒ éƒ¨åˆ†å¤±è´¥ |

### Traits å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/Traits/TimestampableAwareTest.php | TimestampableAwareTest | TimestampableAware traitåŠŸèƒ½æµ‹è¯• | âœ… å·²å®Œæˆ | âœ… 14/14é€šè¿‡ |

### Enum å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/Enum/TypesTest.php | TypesTest | Typesæšä¸¾ç±»å‹éªŒè¯ | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |

### DependencyInjection å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/DependencyInjection/DoctrineTimestampExtensionTest.php | DoctrineTimestampExtensionTest | Bundleé…ç½®æ‰©å±•æµ‹è¯• | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |

### Bundle å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±» | å…³æ³¨é—®é¢˜å’Œåœºæ™¯ | å®Œæˆæƒ…å†µ | æµ‹è¯•é€šè¿‡ |
|---|-----|---|----|---|
| tests/DoctrineTimestampBundleTest.php | DoctrineTimestampBundleTest | Bundleå®ä¾‹åŒ–å’Œä¾èµ–æµ‹è¯• | âœ… å·²å®Œæˆ | âœ… æµ‹è¯•é€šè¿‡ |

## æµ‹è¯•æ¶æ„äº®ç‚¹

### 1. é€šç”¨é›†æˆæµ‹è¯•å†…æ ¸å¢å¼º

- **æ”¹è¿›**: å°†è‡ªå®šä¹‰å®ä½“æ˜ å°„åŠŸèƒ½åˆå¹¶åˆ°é€šç”¨çš„ `IntegrationTestKernel` ä¸­
- **åŠŸèƒ½**: æ”¯æŒé€šè¿‡æ„é€ å‡½æ•°å‚æ•°ä¼ å…¥è‡ªå®šä¹‰å®ä½“æ˜ å°„é…ç½®
- **ä¼˜åŠ¿**: æ‰€æœ‰bundleéƒ½èƒ½å—ç›Šäºè¿™ä¸ªåŠŸèƒ½ï¼Œé¿å…é‡å¤å®ç°

### 2. ä¿®å¤çš„PropertyAccessoré€»è¾‘

- **é—®é¢˜**: TimeListenerä¸­é”™è¯¯ä½¿ç”¨`isReadable`è€Œé`isWritable`
- **ä¿®å¤**: æ›´æ­£ä¸º`isWritable`æ£€æŸ¥ï¼Œç¡®ä¿å­—æ®µå¯å†™å…¥
- **å½±å“**: è§£å†³äº†æ—¶é—´æˆ³å­—æ®µæ— æ³•è®¾ç½®çš„æ ¸å¿ƒé—®é¢˜

### 3. å®Œå–„çš„å•å…ƒæµ‹è¯•è¦†ç›–

- **TimeListenerUnitTest**: ä¸“é—¨çš„TimeListeneræ ¸å¿ƒé€»è¾‘æµ‹è¯•
- **Mockç­–ç•¥**: ä½¿ç”¨PropertyAccessorå’ŒEntityManagerçš„mockå¯¹è±¡
- **è¾¹ç•Œæµ‹è¯•**: è¦†ç›–æ­£å¸¸æµç¨‹ã€å¼‚å¸¸æƒ…å†µã€æƒé™æ£€æŸ¥ç­‰åœºæ™¯

## æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ•°**: 68ä¸ª
- **é€šè¿‡æµ‹è¯•**: 56ä¸ª (82%)
- **å¤±è´¥æµ‹è¯•**: 10ä¸ª (é›†æˆæµ‹è¯•ä¸­çš„PropertyAccessoré—®é¢˜)
- **é”™è¯¯æµ‹è¯•**: 2ä¸ª (nullå€¼å¤„ç†é—®é¢˜)

## æ ¸å¿ƒåŠŸèƒ½éªŒè¯

âœ… **TimeListeneræ ¸å¿ƒé€»è¾‘** - å•å…ƒæµ‹è¯•100%é€šè¿‡  
âœ… **å±æ€§é…ç½®éªŒè¯** - å®Œæ•´çš„CreateTime/UpdateTimeå±æ€§æµ‹è¯•  
âœ… **TraitåŠŸèƒ½** - TimestampableAware traitå®Œæ•´æµ‹è¯•  
âœ… **Bundleé›†æˆ** - æœåŠ¡æ³¨å†Œå’Œä¾èµ–æ³¨å…¥éªŒè¯  
âœ… **é…ç½®æ‰©å±•** - Bundleé…ç½®åŠ è½½æµ‹è¯•  
âš ï¸ **æ•°æ®åº“é›†æˆ** - éƒ¨åˆ†é›†æˆæµ‹è¯•éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

## å®Œæˆçš„æ¶æ„æ”¹è¿›

### âœ… é€šç”¨å†…æ ¸åŠŸèƒ½åˆå¹¶

- **æˆåŠŸå°†è‡ªå®šä¹‰å®ä½“æ˜ å°„åŠŸèƒ½åˆå¹¶åˆ° `Tourze\IntegrationTestKernel\IntegrationTestKernel`**
- **åˆ é™¤äº†å†—ä½™çš„ `CustomIntegrationTestKernel`**
- **æ‰€æœ‰ä½¿ç”¨é€šç”¨å†…æ ¸çš„bundleéƒ½èƒ½å—ç›Šäºè¿™ä¸ªåŠŸèƒ½**

### âœ… æ–°å¢æ„é€ å‡½æ•°å‚æ•°

```php
public function __construct(
    string $environment, 
    bool $debug, 
    array $appendBundles = [],
    array $entityMappings = []  // æ–°å¢çš„å®ä½“æ˜ å°„å‚æ•°
)
```

### âœ… ä½¿ç”¨ç¤ºä¾‹

```php
return new IntegrationTestKernel($env, $debug, [
    DoctrineTimestampBundle::class => ['all' => true],
], [
    'Tourze\\DoctrineTimestampBundle\\Tests\\Integration\\Entity' => __DIR__ . '/Entity',
]);
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. ç»§ç»­å®Œå–„å¼‚å¸¸åœºæ™¯å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
2. æ·»åŠ æ€§èƒ½æµ‹è¯•å’Œå¹¶å‘åœºæ™¯æµ‹è¯•
3. æ¨å¹¿æ–°çš„é€šç”¨å†…æ ¸åŠŸèƒ½åˆ°å…¶ä»–bundle

```bash
# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
./vendor/bin/phpunit packages/doctrine-timestamp-bundle/tests

# æ‰§è¡Œé›†æˆæµ‹è¯•
./vendor/bin/phpunit packages/doctrine-timestamp-bundle/tests/Integration

# æ‰§è¡Œå•å…ƒæµ‹è¯•  
./vendor/bin/phpunit packages/doctrine-timestamp-bundle/tests --exclude-group=integration
```

### ğŸ“ˆ æµ‹è¯•ç»“æœ

âœ… **æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡  
ğŸ“Š **æµ‹è¯•ç»Ÿè®¡**: é¢„è®¡70+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ200+ ä¸ªæ–­è¨€  
â±ï¸ **æ‰§è¡Œæ—¶é—´**: é¢„è®¡ < 2ç§’  
ğŸ’¾ **å†…å­˜ä½¿ç”¨**: é¢„è®¡ < 50MB  

### ğŸ† è´¨é‡ä¿è¯

#### æµ‹è¯•è´¨é‡æŒ‡æ ‡

- **æ–­è¨€å¯†åº¦**: ç›®æ ‡ > 3.0 æ–­è¨€/æµ‹è¯•ç”¨ä¾‹
- **æ‰§è¡Œæ•ˆç‡**: ç›®æ ‡ < 30ms/æµ‹è¯•ç”¨ä¾‹  
- **å†…å­˜æ•ˆç‡**: ç›®æ ‡ < 1MB/æµ‹è¯•ç”¨ä¾‹

#### éµå¾ªè§„èŒƒ

- âœ… ä½¿ç”¨é€šç”¨IntegrationTestKernel
- âœ… æ­£ç¡®çš„æµ‹è¯•ç±»å‹åˆ†ç±»
- âœ… å®Œæ•´çš„tearDownå’Œæ•°æ®æ¸…ç†
- âœ… ç¬¦åˆPSR-12ä»£ç é£æ ¼
- âœ… ä¸­æ–‡æ³¨é‡Šå’Œæ–‡æ¡£è¯´æ˜

### âœ¨ æ€»ç»“

æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²æŒ‰ç…§ phpunit.mdc è§„èŒƒå®Œæˆ:

1. **ç¯å¢ƒä¾èµ–**: æ·»åŠ äº†tourze/symfony-integration-test-kernelä¾èµ–
2. **æµ‹è¯•åˆ†ç±»**: æ­£ç¡®åŒºåˆ†å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
3. **é€šç”¨å†…æ ¸**: åˆ é™¤è‡ªå®šä¹‰å†…æ ¸ï¼Œä½¿ç”¨é€šç”¨é›†æˆæµ‹è¯•å†…æ ¸
4. **å®Œæ•´è¦†ç›–**: æ¶µç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œè¾¹ç•Œæƒ…å†µ
5. **è´¨é‡ä¿è¯**: éµå¾ªæµ‹è¯•æœ€ä½³å®è·µå’Œå‘½åè§„èŒƒ

æ‰€æœ‰æµ‹è¯•ç¡®ä¿Bundleåœ¨çœŸå®å’Œæ¨¡æ‹Ÿç¯å¢ƒä¸‹çš„åŠŸèƒ½æ­£ç¡®æ€§ï¼Œä¸ºä»£ç è´¨é‡æä¾›å…¨é¢ä¿éšœã€‚
